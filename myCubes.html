<?php require "login/loginheader.php"; 
//require 'admin/adminfunctions.php';
$username = $_SESSION['username'];
$admin = $_SESSION['admin'];

//$results = getUsers();

?>
<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->



    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>THE CUBE - My Cubes</title>
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">




        <!-- ============================================
        ================= Stylesheets ===================
        ============================================= -->
        <!-- vendor css files -->
        <link rel="stylesheet" href="../assets/css/vendor/bootstrap.min.css">
        <link rel="stylesheet" href="../assets/css/vendor/animate.css">
        <link rel="stylesheet" href="../assets/css/vendor/font-awesome.min.css">
        <link rel="stylesheet" href="../assets/js/vendor/animsition/css/animsition.min.css">
        <link rel="stylesheet" href="../assets/js/vendor/daterangepicker/daterangepicker-bs3.css">
        <link rel="stylesheet" href="../assets/js/vendor/morris/morris.css">
        <link rel="stylesheet" href="../assets/js/vendor/owl-carousel/owl.carousel.css">
        <link rel="stylesheet" href="../assets/js/vendor/owl-carousel/owl.theme.css">
        <link rel="stylesheet" href="../assets/js/vendor/rickshaw/rickshaw.min.css">
        <link rel="stylesheet" href="../assets/js/vendor/datetimepicker/css/bootstrap-datetimepicker.min.css">
        <link rel="stylesheet" href="../assets/js/vendor/datatables/css/jquery.dataTables.min.css">
        <link rel="stylesheet" href="../assets/js/vendor/datatables/datatables.bootstrap.min.css">
        <link rel="stylesheet" href="../assets/js/vendor/chosen/chosen.css">
        <link rel="stylesheet" href="../assets/js/vendor/summernote/summernote.css">
        <link rel="stylesheet" href="assets/js/vendor/toastr/toastr.min.css">
        <link rel="stylesheet" href="../assets/js/vendor/footable/css/footable.core.min.css">
		<link rel="stylesheet" href="../assets/js/vendor/toastr/toastr.min.css">
        
        <link rel="stylesheet" href="../assets/js/vendor/flipclock/flipclock.css">

        <!-- project main css files -->
        <link rel="stylesheet" href="../assets/css/main.css">
        <!--/ stylesheets -->



        <!-- ==========================================
        ================= Modernizr ===================
        =========================================== -->
        <script src="../assets/js/vendor/modernizr/modernizr-2.8.3-respond-1.4.2.min.js"></script>
        <!--/ modernizr -->

     <script type="text/javascript" src="http://code.jquery.com/jquery-1.5.1.min.js"></script>
        <script type="text/javascript">
           $(document).ready(function(){
                $("#header").load("../assets/html/header.html"); 
                localStorage.setItem("userName", "<?php echo $username ?>");
				localStorage.setItem("admin", "<?php echo $admin ?>");
                localStorage.setItem("currentPage", "myCubes");
                $("#sidebar-wrap").load("../assets/html/navigationTree.html"); 
           });
        </script> 
        
     <style>
	 

	 th {text-align:center}
         img {
        max-width: 100%;
        max-height: 100%;
    }
    #inner {
  width: 95%;
  margin: 0 auto;
}
    


     </stylE>


    </head>





    <body id="minovate" class="appWrapper">






        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->












        <!-- ====================================================
        ================= Application Content ===================
        ===================================================== -->
        <div id="wrap" class="animsition">






            <!-- ===============================================
            ================= HEADER Content LOAD DYNAMICALLY===================
            ================================================ -->
            <div id="header">

             </div>





            <!-- =================================================
            ================= CONTROLS Content ===================
            ================================================== -->
            <div id="controls">





                <!-- ================================================
                ================= SIDEBAR Content LOADED DYNAMICALLY===================
                ================================================= -->
                <aside id="sidebar" class="scheme-black sidebar-scheme" data-scheme="scheme-black">


                    <div id="sidebar-wrap">

                        

                    </div>


                </aside>
                <!--/ SIDEBAR Content -->





                <!-- =================================================
                ================= RIGHTBAR Content ===================
                ================================================== -->
                <aside id="rightbar">

                    <div role="tabpanel">

                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#users" aria-controls="users" role="tab" data-toggle="tab"><i class="fa fa-users"></i></a></li>
                            <li role="presentation"><a href="#history" aria-controls="history" role="tab" data-toggle="tab"><i class="fa fa-clock-o"></i></a></li>
                            <li role="presentation"><a href="#friends" aria-controls="friends" role="tab" data-toggle="tab"><i class="fa fa-heart"></i></a></li>
                            <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab"><i class="fa fa-cog"></i></a></li>
                        </ul>

                        

                    </div>

                </aside>
                <!--/ RIGHTBAR Content -->




            </div>
            <!--/ CONTROLS Content -->




            <!-- ====================================================
            ================= CONTENT ===============================
            ===================================================== -->
            <section id="content">

                <div class="page page-dashboard">
                
                    <div class="row">

                    
                        <div class="col-md-10">
                            
                            <div class="pageheader">

                            <h2><strong>My Cubes </strong> <span></span></h2>


                        </div>

                        </div>
                        
                    </div>
                    
                    <div class="row" id='cubeInfoRow'>
                        <div class="col-md-12">

                             <!-- tile -->
                            <section class="tile">

                                <!-- tile header -->
                                <div class="tile-header dvd dvd-btm">
                                    <h1 class="custom-font"><strong>Cube</strong> Info</h1>
                                    <ul class="controls">
                                        <li class="dropdown">

                                            <a role="button" tabindex="0" class="dropdown-toggle settings" data-toggle="dropdown">
                                                <i class="fa fa-cog"></i>
                                                <i class="fa fa-spinner fa-spin"></i>
                                            </a>

                                            <ul class="dropdown-menu pull-right with-arrow animated littleFadeInUp">
                                                <li>
                                                    <a role="button" tabindex="0" class="tile-toggle">
                                                        <span class="minimize"><i class="fa fa-angle-down"></i>&nbsp;&nbsp;&nbsp;Minimize</span>
                                                        <span class="expand"><i class="fa fa-angle-up"></i>&nbsp;&nbsp;&nbsp;Expand</span>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a role="button" tabindex="0" class="tile-refresh">
                                                        <i class="fa fa-refresh"></i> Refresh
                                                    </a>
                                                </li>
                                                <li>
                                                    <a role="button" tabindex="0" class="tile-fullscreen">
                                                        <i class="fa fa-expand"></i> Fullscreen
                                                    </a>
                                                </li>
                                            </ul>

                                        </li>
                                        <li class="remove"><a role="button" tabindex="0" class="tile-close"><i class="fa fa-times"></i></a></li>
                                    </ul>
                                </div>
                                <!-- /tile header -->

                                <!-- tile body -->
                                <div class="tile-body">
								
									<div class="row">
									<div class="col-md-4">
									</div>
										<div class="col-md-4 text-center">
                                                    <!-- tile body -->
												<div class="tile-widget bg-slategray text-center p-5">
													<h4 class="custom-font text-strong">Status</h4>
												</div>
												<div class="tile-body text-center">

													<ul class="list-inline tbox m-0">
														<li class="b-r tcol">
															<h2 class="m-0" id="onlineCubes">0</h2>
															<span class="text-muted">Online</span>
														</li>
														<li class="tcol">
															<h2 class="m-0" id="totalCubes">0</h2>
															<span class="text-muted">Total Cubes</span>
														</li>
													</ul>

												</div>
												<!-- /tile body -->
                                                </div>
									
									</div>
								
                                    <!--<div class="form-group">
                                        <label for="filterHealth" style="padding-top: 5px">Search:</label>
                                        <input id="filterHealth" type="text" class="form-control input-sm w-sm mb-10 inline-block"/>
                                    </div>-->

                                    <table id="infoResults" style="cursor: pointer;" data-filter="#filterHealth" data-page-size="15" class="footable table table-custom">
                                        <thead>
                                        <tr>
											<th data-hide='phone'>ID</th>
                                            <th >Cube Name</th>
                                            <th data-hide='phone'>Status</th>
                                            <th data-hide='phone, tablet'>Last Updated</th>
											
                                           
                                        </tr>
                                        </thead>
                                        <tbody id='infoBody'>
                                       
                                        
                                        </tbody>
                                        <tfoot class="hide-if-no-paging">
                                        <tr>
                                            <td colspan="4" class="text-center">
                                                <ul class="pagination"></ul>
                                            </td>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <!-- /tile body -->

                            </section>
                            <!-- /tile -->
                        </div>
                        <!-- /col -->
                    
                    
                    </div>
                    
                    
                    
                   
					
                    
                    
                    
                    <div class="row">
      
					
                    
                    </div>
                    
                    

                </div>

                
            </section>
            <!--/ CONTENT -->


		<button id='cubeDetailsModal' class="btn btn-primary mb-10" data-toggle="modal" data-target="#splash" data-options="splash-2 splash-ef-11"></button>
		
		<!-- Splash Modal -->
        <div class="modal splash fade" id="splash" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title custom-font">Cube Details</h3>
                    </div>
                    <div class="modal-body">
						<div id="cubeID"></div>
						<div class="row">
							<center>
							<div id="cubeName"></div>
							<div><button type='button' id='editNameBtn' class='btn btn-default btn-xs mb-10'><i class='fa fa-pencil'></i> Edit</button></div>
							</center>
						</div>
						<div class="row" id="editNameRow">
							<div class="col-md-2">
							</div>
							
							<div class="col-md-4">
								<input type="text" class="form-control" id="newCubeName" placeholder="New Cube Name...">
							</div>
						
							<div class="col-md-6">
								<button id="submitName" class="btn btn-success btn-ef btn-ef-3 btn-ef-3c mb-10">Submit <i class="fa fa-arrow-right"></i></button>
								<button id="cancelName" class="btn btn-danger btn-ef btn-ef-3 btn-ef-3c mb-10">Cancel <i class="fa fa-times"></i></button>
							</div>
						</div>	
						
						
						
                    </div>
                    <div class="modal-footer">
						<button class="btn btn-ef btn-ef-1 btn-ef-1f mb-10" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!--/ Application Content -->














        <!-- ============================================
        ============== Vendor JavaScripts ===============
        ============================================= -->
		<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.8.0.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="assets/js/vendor/jquery/jquery-1.11.2.min.js"><\/script>')</script>

        <script src="../assets/js/vendor/bootstrap/bootstrap.min.js"></script>

        <script src="../assets/js/vendor/jRespond/jRespond.min.js"></script>

        <script src="../assets/js/vendor/d3/d3.min.js"></script>
        <script src="../assets/js/vendor/d3/d3.layout.min.js"></script>

        <script src="../assets/js/vendor/rickshaw/rickshaw.min.js"></script>

        <script src="../assets/js/vendor/sparkline/jquery.sparkline.min.js"></script>

        <script src="../assets/js/vendor/slimscroll/jquery.slimscroll.min.js"></script>

        <script src="../assets/js/vendor/animsition/js/jquery.animsition.min.js"></script>

        <script src="../assets/js/vendor/daterangepicker/moment.min.js"></script>
        <script src="../assets/js/vendor/daterangepicker/daterangepicker.js"></script>

        <script src="../assets/js/vendor/screenfull/screenfull.min.js"></script>

        <script src="../assets/js/vendor/flot/jquery.flot.min.js"></script>
        <script src="../assets/js/vendor/flot-tooltip/jquery.flot.tooltip.min.js"></script>
        <script src="../assets/js/vendor/flot-spline/jquery.flot.spline.min.js"></script>

        <script src="../assets/js/vendor/easypiechart/jquery.easypiechart.min.js"></script>

        <script src="../assets/js/vendor/raphael/raphael-min.js"></script>
        <script src="../assets/js/vendor/morris/morris.min.js"></script>

        <script src="../assets/js/vendor/owl-carousel/owl.carousel.min.js"></script>

        <script src="../assets/js/vendor/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>

        <script src="../assets/js/vendor/datatables/js/jquery.dataTables.min.js"></script>
        <script src="../assets/js/vendor/datatables/extensions/dataTables.bootstrap.js"></script>

        <script src="../assets/js/vendor/chosen/chosen.jquery.min.js"></script>

        <script src="../assets/js/vendor/summernote/summernote.min.js"></script>

        <script src="../assets/js/vendor/coolclock/coolclock.js"></script>
        <script src="../assets/js/vendor/coolclock/excanvas.js"></script>
        
        
        <script src="../assets/js/vendor/jqvmap/jquery.vmap.min.js"></script>
        <script src="../assets/js/vendor/jqvmap/maps/jquery.vmap.world.js"></script>
        <script src="../assets/js/vendor/jqvmap/maps/jquery.vmap.usa.js"></script>
        <script src="../assets/js/vendor/jqvmap/maps/jquery.vmap.europe.js"></script>
        <script src="../assets/js/vendor/jqvmap/maps/jquery.vmap.germany.js"></script>
        <script src="../assets/js/vendor/jqvmap/data/jquery.vmap.sampledata.js"></script>
        

        <script src="../assets/js/vendor/footable/footable.all.min.js"></script>
         <script src="../assets/js/vendor/flipclock/flipclock.min.js"></script>
         <script src="../assets/js/vendor/flipclock/jquery.countdown.min.js"></script>

        <!--/ vendor javascripts -->


		<script src="../assets/js/vendor/toastr/toastr.min.js"></script>

        <!-- ============================================
        ============== Custom JavaScripts ===============
        ============================================= -->
        <script src="../assets/js/main.js"></script>
        

        <!--/ custom javascripts -->




        <script src="../assets/js/CUBE.js"></script> 

		<script src="https://cdn.ably.io/lib/ably.min-1.js"></script>

        <!-- ===============================================
        ============== Page Specific Scripts ===============
        ================================================ -->
        <script>
		
		var server = '52.14.243.2';
         var ws;
         var wsUri = "ws://" + server + ":1880/ws/thecube";

        function wsConnect() {
            //console.log("connect",wsUri);
			
            ws = new WebSocket(wsUri);
            ws.onmessage = function(msg) {
                // parse the incoming message as a JSON object
                var data = jQuery.parseJSON(msg.data);
				
				if (data.topic == 'cubeAction'){
					cubeAction(data);
				}
				if (data.topic == 'cubeInfo'){
					cubeInfo(data);
				}

				
            }
            ws.onopen = function() {
                // update the status div with the connection status
                //document.getElementById('status').innerHTML = "connected";
				ws.send("UI:getCubeInfo,<?php echo $username; ?>");
                console.log("connected");
            }
            ws.onclose = function() {
                // update the status div with the connection status
                //document.getElementById('status').innerHTML = "not connected";
                // in case of lost connection tries to reconnect every 3 secs
                setTimeout(wsConnect,3000);
            }
        }
        
        function doit(m) {
            if (ws) { ws.send(m); }
        }
		
		function cubeAction(data) {
			//console.log("An Action wasd received: " + data.topic);
			toastr["success"]("<strong>" +data.cubeName + " said: </strong><br />" + data.message);
		}
		
		function cubeInfo(data) {
		var cubesTotal = Object.keys(data.message).length;
		var cubesOnline = 0;
		console.log("Cube Info Update was received. There are " + cubesTotal + " cubes.");
		if (cubesTotal ==0){
			$('#cubeInfoRow').hide();
		}
		else {
			$('#cubeInfoRow').show();
			var tblHTML = '';
				$.each( data.message, function( key, value ) {
				  //console.log( key + ": " + data.message[key].owner );
					if(data.message[key].status == "1"){
						tblHTML += "<tr align='middle'><td class='cubeID'>" + data.message[key].ID + "</td><td class='cubeName'>" + data.message[key].cubeName + "</td><td class='cubeStatus'><div class='bg-success'><i class='fa fa-check'></i><span>&nbsp;&nbsp;&nbsp;&nbsp;Online</span></div></td><td class='cubeLastTime'>" + data.message[key].lastTime + "</td>";
						cubesOnline += 1;
					}
					else{
						tblHTML += "<tr align='middle'><td class='cubeID'>" + data.message[key].ID + "</td><td class='cubeName'>" + data.message[key].cubeName + "</td><td class='cubeStatus'><div class='bg-lightred'><i class='fa fa-times'></i><span>&nbsp;&nbsp;&nbsp;&nbsp;Offline</span></div></td><td class='cubeLastTime'>" + data.message[key].lastTime + "</td>";

					}
				});
				$('#infoBody').html(tblHTML);
			
			}
			
			$('#onlineCubes').html(cubesOnline);
			$('#totalCubes').html(cubesTotal);
		}
		
		
		$("#infoResults").on("click", "tr", function() {
			var cubeID = $(this).closest('tr').children('td.cubeID').text();
			var cubeName = $(this).closest('tr').children('td.cubeName').text();
			$('#cubeID').html(cubeID);
			$('#cubeID').hide();
			$('#cubeName').html("Cube Name: " + cubeName + " &nbsp;&nbsp;");
			$('#newCubeName').val('')
			document.getElementById("cubeDetailsModal").click(); // Click on the checkbox
        
		});
		
		
			 
            
            
            $(window).load(function(){
				$('#submitName').hide();
				$('#editNameRow').hide();
				
				$('#newCubeName').keyup(function(){

				if($(this).val().length !=0)
					$('#submitName').show();  
						
				else
					$('#submitName').hide();
					
				 })  	
					
				$("#editNameBtn").click(function(){
					$('#editNameBtn').hide();
					$('#editNameRow').show();
				});
				
				$("#cancelName").click(function(){
					$('#editNameRow').hide();
					$('#editNameBtn').show();
				});
				
				$("#submitName").click(function(){
					$('#editNameRow').hide();
					$('#editNameBtn').show();
					var cubeID = $('#cubeID').html();
					var newName = $('#newCubeName').val();
					ws.send("UI:changeCubeName,ID:" + cubeID + ",Name:" + newName);
					ws.send("UI:getCubeInfo,<?php echo $username; ?>");
					$('#cubeName').html("Cube Name: " + newName + " &nbsp;&nbsp;");
				});
				
			wsConnect();
			
			
			
			toastr.options = {
  "closeButton": false,
  "debug": false,
  "newestOnTop": false,
  "progressBar": false,
  "positionClass": "toast-bottom-center",
  "preventDuplicates": false,
  "onclick": null,
  "showDuration": "300",
  "hideDuration": "1000",
  "timeOut": "5000",
  "extendedTimeOut": "1000",
  "showEasing": "swing",
  "hideEasing": "linear",
  "showMethod": "fadeIn",
  "hideMethod": "fadeOut"
}
               
				$('.footable').footable();
				

				
            });
            
          
        </script>
        <!--/ Page Specific Scripts -->






       

    </body>
</html>
